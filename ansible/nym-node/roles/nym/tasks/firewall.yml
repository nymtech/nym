- name: Configure UFW rules
  ufw:
    rule: allow
    port: "{{ item.port }}"
    proto: "{{ item.proto }}"
    comment: "{{ item.comment | default(omit) }}"
  loop: "{{ nym_ufw_rules }}"
  loop_control:
    label: "{{ item.port }}/{{ item.proto }}"
  when:
    - nym_ufw_enable
    - item.when | default(true)

- name: Allow bandwidth/topup rule inside WG tunnel
  command: >
    ufw allow in on nymwg to any port 51830 proto tcp comment 'bandwidth queries/topup'
  when:
    - nym_ufw_enable
    - (wireguard_enabled | bool)

- name: Enable UFW
  ufw:
    state: enabled
  when:
    nym_ufw_enable
